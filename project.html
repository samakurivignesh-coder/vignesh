import React, { useState, useEffect } from 'react';
import { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, BarChart, Bar, PieChart, Pie, Cell } from 'recharts';
import { Calendar, TrendingUp, Heart, Brain, Moon, Zap, Book, Users, Target, Award, Plus, ChevronLeft, ChevronRight } from 'lucide-react';

const MentalHealthPlatform = () => {
  const [currentPage, setCurrentPage] = useState('dashboard');
  const [moodEntries, setMoodEntries] = useState([
    { date: '2025-09-07', mood: 7, note: 'Good day at work, felt productive', sentiment: 'positive' },
    { date: '2025-09-08', mood: 5, note: 'Stressed about deadlines', sentiment: 'neutral' },
    { date: '2025-09-09', mood: 8, note: 'Great weekend with friends!', sentiment: 'positive' },
    { date: '2025-09-10', mood: 4, note: 'Feeling overwhelmed', sentiment: 'negative' },
    { date: '2025-09-11', mood: 6, note: 'Better today, went for a walk', sentiment: 'neutral' },
    { date: '2025-09-12', mood: 9, note: 'Amazing day! Achieved my goals', sentiment: 'positive' },
    { date: '2025-09-13', mood: 7, note: 'Relaxing Saturday, good self-care', sentiment: 'positive' }
  ]);
  
  const [currentMood, setCurrentMood] = useState(5);
  const [currentNote, setCurrentNote] = useState('');
  const [selectedDate, setSelectedDate] = useState(new Date().toISOString().split('T')[0]);

  // Sentiment Analysis Function
  const analyzeSentiment = (text) => {
    const positiveWords = ['good', 'great', 'amazing', 'wonderful', 'happy', 'excited', 'love', 'excellent', 'fantastic', 'awesome', 'productive', 'achieved', 'success', 'relaxing'];
    const negativeWords = ['bad', 'terrible', 'awful', 'sad', 'depressed', 'anxious', 'stressed', 'overwhelmed', 'worried', 'frustrated', 'angry', 'disappointed'];
    
    const words = text.toLowerCase().split(' ');
    let positiveCount = 0;
    let negativeCount = 0;
    
    words.forEach(word => {
      if (positiveWords.some(pw => word.includes(pw))) positiveCount++;
      if (negativeWords.some(nw => word.includes(nw))) negativeCount++;
    });
    
    if (positiveCount > negativeCount) return 'positive';
    if (negativeCount > positiveCount) return 'negative';
    return 'neutral';
  };

  // Add new mood entry
  const addMoodEntry = () => {
    if (currentNote.trim() === '') return;
    
    const sentiment = analyzeSentiment(currentNote);
    const newEntry = {
      date: selectedDate,
      mood: currentMood,
      note: currentNote,
      sentiment: sentiment
    };
    
    const existingEntryIndex = moodEntries.findIndex(entry => entry.date === selectedDate);
    if (existingEntryIndex >= 0) {
      const updatedEntries = [...moodEntries];
      updatedEntries[existingEntryIndex] = newEntry;
      setMoodEntries(updatedEntries);
    } else {
      setMoodEntries([...moodEntries, newEntry].sort((a, b) => new Date(a.date) - new Date(b.date)));
    }
    
    setCurrentNote('');
    setCurrentMood(5);
  };

  // Generate personalized recommendations
  const getRecommendations = () => {
    const recentEntries = moodEntries.slice(-7);
    const avgMood = recentEntries.reduce((sum, entry) => sum + entry.mood, 0) / recentEntries.length;
    const sentimentCounts = recentEntries.reduce((acc, entry) => {
      acc[entry.sentiment] = (acc[entry.sentiment] || 0) + 1;
      return acc;
    }, {});
    
    const recommendations = [];
    
    if (avgMood < 5) {
      recommendations.push({
        type: 'exercise',
        title: 'Try Light Exercise',
        description: 'A 15-minute walk can boost endorphins and improve mood',
        icon: 'üö∂‚Äç‚ôÇÔ∏è'
      });
      recommendations.push({
        type: 'mindfulness',
        title: 'Guided Meditation',
        description: '5-minute breathing exercise to reduce stress',
        icon: 'üßò‚Äç‚ôÄÔ∏è'
      });
    }
    
    if (sentimentCounts.negative > 2) {
      recommendations.push({
        type: 'social',
        title: 'Connect with Friends',
        description: 'Reach out to someone you care about',
        icon: 'üë•'
      });
      recommendations.push({
        type: 'therapy',
        title: 'Journal Writing',
        description: 'Write down your thoughts and feelings',
        icon: 'üìù'
      });
    }
    
    if (avgMood >= 7) {
      recommendations.push({
        type: 'maintenance',
        title: 'Keep It Up!',
        description: 'Continue your positive habits',
        icon: '‚≠ê'
      });
      recommendations.push({
        type: 'growth',
        title: 'Try Something New',
        description: 'Challenge yourself with a new activity',
        icon: 'üéØ'
      });
    }
    
    return recommendations.slice(0, 4);
  };

  // Calculate statistics
  const getStats = () => {
    const last30Days = moodEntries.slice(-30);
    const avgMood = last30Days.reduce((sum, entry) => sum + entry.mood, 0) / last30Days.length;
    
    const sentimentData = last30Days.reduce((acc, entry) => {
      acc[entry.sentiment] = (acc[entry.sentiment] || 0) + 1;
      return acc;
    }, { positive: 0, neutral: 0, negative: 0 });
    
    const trend = last30Days.length >= 2 ? 
      (last30Days[last30Days.length - 1].mood - last30Days[0].mood) : 0;
    
    return { avgMood, sentimentData, trend };
  };

  const stats = getStats();
  const recommendations = getRecommendations();

  const moodColors = ['#ef4444', '#f97316', '#eab308', '#84cc16', '#22c55e', '#06b6d4', '#3b82f6', '#8b5cf6', '#a855f7', '#ec4899'];
  const sentimentColors = { positive: '#22c55e', neutral: '#eab308', negative: '#ef4444' };

  const MoodCheckIn = () => (
    <div className="space-y-6">
      <div className="bg-gradient-to-r from-purple-600 to-blue-600 text-white p-6 rounded-xl">
        <h2 className="text-2xl font-bold mb-2">Daily Mood Check-In</h2>
        <p className="opacity-90">How are you feeling today?</p>
      </div>
      
      <div className="bg-white p-6 rounded-xl shadow-lg">
        <div className="mb-6">
          <label className="block text-sm font-medium text-gray-700 mb-3">Select Date</label>
          <input
            type="date"
            value={selectedDate}
            onChange={(e) => setSelectedDate(e.target.value)}
            className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"
          />
        </div>
        
        <div className="mb-6">
          <label className="block text-sm font-medium text-gray-700 mb-3">
            Mood Level: {currentMood}/10
          </label>
          <div className="flex items-center space-x-2 mb-4">
            {[1, 2, 3, 4, 5, 6, 7, 8, 9, 10].map((level) => (
              <button
                key={level}
                onClick={() => setCurrentMood(level)}
                className={`w-10 h-10 rounded-full text-white font-semibold transition-all ${
                  currentMood >= level ? 'bg-gradient-to-r from-purple-500 to-blue-500 scale-110' : 'bg-gray-300'
                }`}
              >
                {level}
              </button>
            ))}
          </div>
          <div className="text-center text-sm text-gray-600">
            {currentMood <= 3 && "üòû Low mood - Remember, it's okay to feel this way"}
            {currentMood > 3 && currentMood <= 7 && "üòê Moderate mood - You're doing okay"}
            {currentMood > 7 && "üòä Great mood - Keep up the positive energy!"}
          </div>
        </div>
        
        <div className="mb-6">
          <label className="block text-sm font-medium text-gray-700 mb-3">
            What's on your mind? (This helps with sentiment analysis)
          </label>
          <textarea
            value={currentNote}
            onChange={(e) => setCurrentNote(e.target.value)}
            className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 h-24 resize-none"
            placeholder="Share your thoughts, feelings, or what happened today..."
          />
        </div>
        
        <button
          onClick={addMoodEntry}
          disabled={!currentNote.trim()}
          className="w-full bg-gradient-to-r from-purple-600 to-blue-600 text-white py-3 px-6 rounded-lg font-semibold disabled:opacity-50 disabled:cursor-not-allowed hover:from-purple-700 hover:to-blue-700 transition-all"
        >
          <Plus className="w-5 h-5 inline mr-2" />
          Save Mood Entry
        </button>
      </div>
    </div>
  );

  const Dashboard = () => (
    <div className="space-y-6">
      {/* Welcome Header */}
      <div className="bg-gradient-to-r from-indigo-600 via-purple-600 to-pink-600 text-white p-6 rounded-xl">
        <h1 className="text-3xl font-bold mb-2">Welcome to Your Wellness Journey</h1>
        <p className="opacity-90">Track your mental health and discover insights about your wellbeing</p>
      </div>

      {/* Quick Stats */}
      <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
        <div className="bg-white p-6 rounded-xl shadow-lg border-l-4 border-green-500">
          <div className="flex items-center justify-between">
            <div>
              <p className="text-sm font-medium text-gray-600">Average Mood (30 days)</p>
              <p className="text-3xl font-bold text-green-600">{stats.avgMood.toFixed(1)}</p>
            </div>
            <Heart className="w-8 h-8 text-green-500" />
          </div>
        </div>
        
        <div className="bg-white p-6 rounded-xl shadow-lg border-l-4 border-blue-500">
          <div className="flex items-center justify-between">
            <div>
              <p className="text-sm font-medium text-gray-600">Mood Trend</p>
              <p className={`text-3xl font-bold ${stats.trend > 0 ? 'text-green-600' : stats.trend < 0 ? 'text-red-600' : 'text-gray-600'}`}>
                {stats.trend > 0 ? 'üìà' : stats.trend < 0 ? 'üìâ' : '‚û°Ô∏è'}
              </p>
            </div>
            <TrendingUp className="w-8 h-8 text-blue-500" />
          </div>
        </div>
        
        <div className="bg-white p-6 rounded-xl shadow-lg border-l-4 border-purple-500">
          <div className="flex items-center justify-between">
            <div>
              <p className="text-sm font-medium text-gray-600">Total Check-ins</p>
              <p className="text-3xl font-bold text-purple-600">{moodEntries.length}</p>
            </div>
            <Calendar className="w-8 h-8 text-purple-500" />
          </div>
        </div>
      </div>

      {/* Mood Trend Chart */}
      <div className="bg-white p-6 rounded-xl shadow-lg">
        <h3 className="text-xl font-semibold mb-4 flex items-center">
          <TrendingUp className="w-5 h-5 mr-2 text-blue-500" />
          Mood Trends (Last 30 Days)
        </h3>
        <ResponsiveContainer width="100%" height={300}>
          <LineChart data={moodEntries.slice(-30)}>
            <CartesianGrid strokeDasharray="3 3" />
            <XAxis 
              dataKey="date" 
              tickFormatter={(date) => new Date(date).toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}
            />
            <YAxis domain={[1, 10]} />
            <Tooltip 
              labelFormatter={(date) => new Date(date).toLocaleDateString()}
              formatter={(value) => [`${value}/10`, 'Mood Level']}
            />
            <Line 
              type="monotone" 
              dataKey="mood" 
              stroke="#8b5cf6" 
              strokeWidth={3}
              dot={{ fill: '#8b5cf6', strokeWidth: 2, r: 4 }}
            />
          </LineChart>
        </ResponsiveContainer>
      </div>

      {/* Sentiment Analysis */}
      <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <div className="bg-white p-6 rounded-xl shadow-lg">
          <h3 className="text-xl font-semibold mb-4 flex items-center">
            <Brain className="w-5 h-5 mr-2 text-indigo-500" />
            Sentiment Analysis
          </h3>
          <ResponsiveContainer width="100%" height={200}>
            <PieChart>
              <Pie
                data={Object.entries(stats.sentimentData).map(([key, value]) => ({
                  name: key.charAt(0).toUpperCase() + key.slice(1),
                  value,
                  color: sentimentColors[key]
                }))}
                cx="50%"
                cy="50%"
                outerRadius={80}
                dataKey="value"
              >
                {Object.entries(stats.sentimentData).map(([key], index) => (
                  <Cell key={`cell-${index}`} fill={sentimentColors[key]} />
                ))}
              </Pie>
              <Tooltip />
            </PieChart>
          </ResponsiveContainer>
        </div>

        {/* Quick Actions */}
        <div className="bg-white p-6 rounded-xl shadow-lg">
          <h3 className="text-xl font-semibold mb-4 flex items-center">
            <Zap className="w-5 h-5 mr-2 text-yellow-500" />
            Quick Actions
          </h3>
          <div className="space-y-3">
            <button 
              onClick={() => setCurrentPage('checkin')}
              className="w-full p-3 bg-gradient-to-r from-purple-500 to-blue-500 text-white rounded-lg hover:from-purple-600 hover:to-blue-600 transition-all"
            >
              üìù Daily Check-in
            </button>
            <button 
              onClick={() => setCurrentPage('trends')}
              className="w-full p-3 bg-gradient-to-r from-green-500 to-teal-500 text-white rounded-lg hover:from-green-600 hover:to-teal-600 transition-all"
            >
              üìä View Detailed Trends
            </button>
            <button 
              onClick={() => setCurrentPage('recommendations')}
              className="w-full p-3 bg-gradient-to-r from-orange-500 to-red-500 text-white rounded-lg hover:from-orange-600 hover:to-red-600 transition-all"
            >
              üí° Get Recommendations
            </button>
          </div>
        </div>
      </div>
    </div>
  );

  const Trends = () => (
    <div className="space-y-6">
      <div className="bg-gradient-to-r from-blue-600 to-indigo-600 text-white p-6 rounded-xl">
        <h2 className="text-2xl font-bold mb-2">Detailed Trends & Analytics</h2>
        <p className="opacity-90">Deeper insights into your mental health patterns</p>
      </div>

      {/* Weekly Mood Distribution */}
      <div className="bg-white p-6 rounded-xl shadow-lg">
        <h3 className="text-xl font-semibold mb-4">Weekly Mood Distribution</h3>
        <ResponsiveContainer width="100%" height={300}>
          <BarChart data={moodEntries.slice(-7)}>
            <CartesianGrid strokeDasharray="3 3" />
            <XAxis 
              dataKey="date" 
              tickFormatter={(date) => new Date(date).toLocaleDateString('en-US', { weekday: 'short' })}
            />
            <YAxis domain={[1, 10]} />
            <Tooltip 
              labelFormatter={(date) => new Date(date).toLocaleDateString()}
              formatter={(value) => [`${value}/10`, 'Mood Level']}
            />
            <Bar dataKey="mood" fill="#8b5cf6" />
          </BarChart>
        </ResponsiveContainer>
      </div>

      {/* Recent Entries */}
      <div className="bg-white p-6 rounded-xl shadow-lg">
        <h3 className="text-xl font-semibold mb-4">Recent Entries</h3>
        <div className="space-y-4">
          {moodEntries.slice(-5).reverse().map((entry, index) => (
            <div key={index} className="border-l-4 border-purple-500 pl-4 py-2">
              <div className="flex items-center justify-between mb-2">
                <span className="font-medium">{new Date(entry.date).toLocaleDateString()}</span>
                <div className="flex items-center space-x-2">
                  <span className="text-lg font-bold">{entry.mood}/10</span>
                  <span className={`px-2 py-1 rounded-full text-xs font-medium ${
                    entry.sentiment === 'positive' ? 'bg-green-100 text-green-800' :
                    entry.sentiment === 'negative' ? 'bg-red-100 text-red-800' :
                    'bg-yellow-100 text-yellow-800'
                  }`}>
                    {entry.sentiment}
                  </span>
                </div>
              </div>
              <p className="text-gray-600">{entry.note}</p>
            </div>
          ))}
        </div>
      </div>
    </div>
  );

  const Recommendations = () => (
    <div className="space-y-6">
      <div className="bg-gradient-to-r from-green-600 to-teal-600 text-white p-6 rounded-xl">
        <h2 className="text-2xl font-bold mb-2">Personalized Wellness Recommendations</h2>
        <p className="opacity-90">Based on your recent mood patterns and entries</p>
      </div>

      <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
        {recommendations.map((rec, index) => (
          <div key={index} className="bg-white p-6 rounded-xl shadow-lg hover:shadow-xl transition-shadow">
            <div className="flex items-start space-x-4">
              <div className="text-3xl">{rec.icon}</div>
              <div className="flex-1">
                <h3 className="text-xl font-semibold mb-2">{rec.title}</h3>
                <p className="text-gray-600 mb-4">{rec.description}</p>
                <button className="bg-gradient-to-r from-purple-500 to-blue-500 text-white px-4 py-2 rounded-lg hover:from-purple-600 hover:to-blue-600 transition-all">
                  Try This
                </button>
              </div>
            </div>
          </div>
        ))}
      </div>

      {/* Wellness Resources */}
      <div className="bg-white p-6 rounded-xl shadow-lg">
        <h3 className="text-xl font-semibold mb-4 flex items-center">
          <Book className="w-5 h-5 mr-2 text-blue-500" />
          Wellness Resources
        </h3>
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
          <div className="p-4 border border-gray-200 rounded-lg hover:border-purple-300 transition-colors">
            <h4 className="font-medium mb-2">üßò‚Äç‚ôÄÔ∏è Meditation Apps</h4>
            <p className="text-sm text-gray-600">Try Headspace, Calm, or Insight Timer for guided meditation</p>
          </div>
          <div className="p-4 border border-gray-200 rounded-lg hover:border-purple-300 transition-colors">
            <h4 className="font-medium mb-2">üìû Crisis Support</h4>
            <p className="text-sm text-gray-600">National Suicide Prevention Lifeline: 988</p>
          </div>
          <div className="p-4 border border-gray-200 rounded-lg hover:border-purple-300 transition-colors">
            <h4 className="font-medium mb-2">üèÉ‚Äç‚ôÇÔ∏è Exercise Ideas</h4>
            <p className="text-sm text-gray-600">Walking, yoga, dancing, or any movement that feels good</p>
          </div>
        </div>
      </div>
    </div>
  );

  const Navigation = () => (
    <nav className="bg-white shadow-lg border-t-4 border-purple-500 p-4">
      <div className="flex justify-center space-x-8">
        <button
          onClick={() => setCurrentPage('dashboard')}
          className={`flex items-center space-x-2 px-4 py-2 rounded-lg transition-all ${
            currentPage === 'dashboard' 
              ? 'bg-purple-100 text-purple-700 font-semibold' 
              : 'text-gray-600 hover:text-purple-600 hover:bg-purple-50'
          }`}
        >
          <Heart className="w-5 h-5" />
          <span>Dashboard</span>
        </button>
        
        <button
          onClick={() => setCurrentPage('checkin')}
          className={`flex items-center space-x-2 px-4 py-2 rounded-lg transition-all ${
            currentPage === 'checkin' 
              ? 'bg-purple-100 text-purple-700 font-semibold' 
              : 'text-gray-600 hover:text-purple-600 hover:bg-purple-50'
          }`}
        >
          <Plus className="w-5 h-5" />
          <span>Check-In</span>
        </button>
        
        <button
          onClick={() => setCurrentPage('trends')}
          className={`flex items-center space-x-2 px-4 py-2 rounded-lg transition-all ${
            currentPage === 'trends' 
              ? 'bg-purple-100 text-purple-700 font-semibold' 
              : 'text-gray-600 hover:text-purple-600 hover:bg-purple-50'
          }`}
        >
          <TrendingUp className="w-5 h-5" />
          <span>Trends</span>
        </button>
        
        <button
          onClick={() => setCurrentPage('recommendations')}
          className={`flex items-center space-x-2 px-4 py-2 rounded-lg transition-all ${
            currentPage === 'recommendations' 
              ? 'bg-purple-100 text-purple-700 font-semibold' 
              : 'text-gray-600 hover:text-purple-600 hover:bg-purple-50'
          }`}
        >
          <Target className="w-5 h-5" />
          <span>Recommendations</span>
        </button>
      </div>
    </nav>
  );

  return (
    <div className="min-h-screen bg-gradient-to-br from-purple-50 via-blue-50 to-indigo-100">
      <div className="max-w-6xl mx-auto p-4 pb-20">
        {currentPage === 'dashboard' && <Dashboard />}
        {currentPage === 'checkin' && <MoodCheckIn />}
        {currentPage === 'trends' && <Trends />}
        {currentPage === 'recommendations' && <Recommendations />}
      </div>
      <div className="fixed bottom-0 left-0 right-0">
        <Navigation />
      </div>
    </div>
  );
};

export default MentalHealthPlatform;